---
import type { CollectionEntry } from "astro:content";
// Astro Image can be used later for local assets.
// For now we render the remote URLs from the content collection.

interface Props {
  project: CollectionEntry<"projects">;
}

const { project } = Astro.props;
const dateEn = project.data.publishDate.toLocaleDateString("en-US");
const dateTr = project.data.publishDate.toLocaleDateString("tr-TR");
const projectSlug = project.slug ?? project.id;
---

<article class="project-card">
  <div class="card-image-wrapper">
    <img
      src={project.data.image}
      alt={project.data.title.en}
      class="card-image"
    />
    <div class="overlay">
      <!-- Overlay effect only, no button -->
    </div>
  </div>
  <div class="card-content">
    <div class="card-meta">
      <span class="date">
        <i18n lang="en" data-i18n="project-card-date">{dateEn}</i18n>
        <i18n lang="tr" hidden data-i18n="project-card-date">{dateTr}</i18n>
      </span>
    </div>
    <h3>
      <!-- Main Link with Stretched Overlay -->
      <a href={`/projects/${projectSlug}`} class="main-link">
        <i18n lang="en" data-i18n="project-card-title">
          {project.data.title.en}
        </i18n>
        {
          project.data.title.tr && (
            <i18n lang="tr" hidden data-i18n="project-card-title">
              {project.data.title.tr}
            </i18n>
          )
        }
      </a>
    </h3>
    <p>
      <i18n lang="en" data-i18n="project-card-desc">
        {project.data.description.en}
      </i18n>
      {
        project.data.description.tr && (
          <i18n lang="tr" hidden data-i18n="project-card-desc">
            {project.data.description.tr}
          </i18n>
        )
      }
    </p>
    <div class="tags">
      {project.data.tags.map((tag) => <span class="tag">{tag}</span>)}
    </div>
  </div>
</article>

<style>
  .project-card {
    background: var(--color-white-03); /* Fallback */
    background: linear-gradient(
      145deg,
      var(--color-white-05) 0%,
      var(--color-white-01) 100%
    );
    border: 1px solid var(--color-white-10);
    border-top: 1px solid var(--color-white-15);
    border-radius: var(--radius-md);
    overflow: hidden;
    /* backdrop-filter: blur(10px); REMOVED for performance */
    transition:
      transform 0.3s ease,
      box-shadow 0.3s ease;
    height: 100%;
    display: flex;
    flex-direction: column;
    position: relative;
    /* will-change: transform; REMOVED potentially causing layer dumping */
  }

  .project-card:hover {
    transform: translateY(-5px); /* Reduced movement */
    background: var(--color-white-08);
    box-shadow: 0 20px 40px -10px var(--color-glow-project-card);
    border-color: var(--color-aurora-1);
  }

  /* Stretched Link Pattern */
  .main-link::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 1;
  }

  .card-image-wrapper {
    position: relative;
    aspect-ratio: 16/9;
    overflow: hidden;
    border-radius: var(--radius-sm);
    margin: 1rem;
    margin-bottom: 0;
  }

  .card-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.6s ease;
  }

  .project-card:hover .card-image {
    transform: scale(1.1);
  }

  .overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      to top,
      var(--color-aurora-1),
      var(--color-transparent)
    );
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none; /* Let clicks pass through */
  }

  .project-card:hover .overlay {
    opacity: 0.4;
  }

  .card-content {
    padding: 1.5rem;
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  .card-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
    font-size: 0.8rem;
    color: var(--color-aurora-2);
    font-weight: 600;
  }

  h3 {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    font-family: var(--font-serif);
    transition: all 0.3s;
  }

  h3 a {
    text-decoration: none;
    background: linear-gradient(
      to right,
      var(--color-white),
      var(--color-text-strong)
    );
    -webkit-background-clip: text;
    -webkit-text-fill-color: var(--color-transparent);
    transition: all 0.3s;
  }

  .project-card:hover h3 a {
    /* Matches global H1 gradient */
    background: linear-gradient(
      to right,
      var(--color-text-gradient-start),
      var(--color-text-gradient-end)
    );
    -webkit-background-clip: text;
    -webkit-text-fill-color: var(--color-transparent);
  }

  p {
    margin-bottom: 1.5rem;
    font-size: 0.95rem;
    color: var(--color-text-muted);
    font-weight: 300;
    line-height: 1.6;
    flex: 1;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    position: relative;
    z-index: 2; /* Clickable above stretched entry */
  }

  .tag {
    font-size: 0.75rem;
    padding: 0.25rem 0.75rem;
    background: var(--color-white-05);
    border: 1px solid var(--color-white-10);
    border-radius: 100px;
    color: var(--color-text-strong);
    transition: all 0.2s;
    cursor: default; /* Or pointer if they become interactive */
  }

  .project-card:hover .tag {
    background: var(--color-aurora-1);
    border-color: var(--color-aurora-1);
    color: var(--color-white);
  }
</style>
